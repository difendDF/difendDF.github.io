<!-- build time:Sat Oct 15 2022 10:32:47 GMT+0800 (中国标准时间) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="永恒绿洲" href="https://sprenedayf.com/rss.xml"><link rel="alternate" type="application/atom+xml" title="永恒绿洲" href="https://sprenedayf.com/atom.xml"><link rel="alternate" type="application/json" title="永恒绿洲" href="https://sprenedayf.com/feed.json"><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/artitalk"></script><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="云原生,k8s"><link rel="canonical" href="https://sprenedayf.com/2022/06/07/learn-and-learn/%E4%BA%91%E5%8E%9F%E7%94%9F/k8s%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/"><title>k8s集群搭建 - 云原生 - 学习不止 | TheOnly-DF = 永恒绿洲 = 虽然不容易，只要去做，就能成功</title><meta name="generator" content="Hexo 5.4.2"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">k8s集群搭建</h1><div class="meta"><span class="item" title="创建时间：2022-06-07 10:26:40"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2022-06-07T10:26:40+08:00">2022-06-07</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>10k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>14 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">TheOnly-DF</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><img src="https://tva1.sinaimg.cn/large/75c23013ly8h2zosrmxk4j21l70u0dqd.jpg"></div><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div></header><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/learn-and-learn/" itemprop="item" rel="index" title="分类于 学习不止"><span itemprop="name">学习不止</span></a><meta itemprop="position" content="1"></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/learn-and-learn/%E4%BA%91%E5%8E%9F%E7%94%9F/" itemprop="item" rel="index" title="分类于 云原生"><span itemprop="name">云原生</span></a><meta itemprop="position" content="2"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://sprenedayf.com/2022/06/07/learn-and-learn/%E4%BA%91%E5%8E%9F%E7%94%9F/k8s%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="蝶风"><meta itemprop="description" content="虽然不容易，只要去做，就能成功, 努力学习、生活"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="永恒绿洲"></span><div class="body md" itemprop="articleBody"><h1 id="服务器准备"><a class="anchor" href="#服务器准备">#</a> 服务器准备</h1><table><thead><tr><th>主机名</th><th>公网 IP</th><th>内网 IP</th><th>系统</th><th>配置</th></tr></thead><tbody><tr><td>k8s-master</td><td>119.3.168.188</td><td>192.168.0.194</td><td>CentOS 7.6</td><td>4 核 16G</td></tr><tr><td>k8s-node1</td><td>121.36.55.3</td><td>192.168.0.130</td><td>CentOS 7.6</td><td>4 核 16G</td></tr><tr><td>k8s-node2</td><td>124.70.19.106</td><td>192.168.0.130</td><td>CentOS 7.6</td><td>4 核 16G</td></tr></tbody></table><h1 id="系统前期设置"><a class="anchor" href="#系统前期设置">#</a> 系统前期设置</h1><h2 id="设置主机名"><a class="anchor" href="#设置主机名">#</a> 设置主机名</h2><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>hostnamectl set-hostname k8s-master</pre></td></tr><tr><td data-num="2"></td><td><pre>hostnamectl set-hostname k8s-node1</pre></td></tr><tr><td data-num="3"></td><td><pre>hostnamectl set-hostname k8s-node2</pre></td></tr></table></figure><h2 id="配置hosts文件"><a class="anchor" href="#配置hosts文件">#</a> 配置 hosts 文件</h2><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">cat</span> <span class="token operator">>></span> /etc/hosts<span class="token operator">&lt;&lt;</span><span class="token string">EOF</span></pre></td></tr><tr><td data-num="2"></td><td><pre>192.168.0.194            k8s-master</pre></td></tr><tr><td data-num="3"></td><td><pre>192.168.0.130            k8s-node1</pre></td></tr><tr><td data-num="4"></td><td><pre>192.168.0.245             k8s-node2</pre></td></tr><tr><td data-num="5"></td><td><pre>EOF</pre></td></tr></table></figure><h1 id="安装docker"><a class="anchor" href="#安装docker">#</a> 安装 docker</h1><h2 id="卸载旧版本未安装过则跳过"><a class="anchor" href="#卸载旧版本未安装过则跳过">#</a> 卸载旧版本（未安装过则跳过）</h2><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>yum remove <span class="token function">docker</span> docker-common container-selinux docker-selinux docker-engine</pre></td></tr></table></figure><h2 id="安装新版本"><a class="anchor" href="#安装新版本">#</a> 安装新版本</h2><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">wget</span> https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo -O /etc/yum.repos.d/docker-ce.repo</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># 安装必要工具集</span></pre></td></tr><tr><td data-num="4"></td><td><pre>yum <span class="token function">install</span> -y yum-utils</pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment"># 添加 docker 的 yum 源</span></pre></td></tr><tr><td data-num="7"></td><td><pre>yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo <span class="token comment">#阿里云</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment"># 更新 yum 缓存</span></pre></td></tr><tr><td data-num="10"></td><td><pre>yum makecache fast</pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment"># 查看 docker 版本信息</span></pre></td></tr><tr><td data-num="13"></td><td><pre>yum list docker-ce --showduplicates <span class="token operator">|</span> <span class="token function">sort</span> -r</pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token comment"># 挑选指定版本安装 yum -y install docker-ce-&lt; 版本号 ></span></pre></td></tr><tr><td data-num="16"></td><td><pre>yum -y <span class="token function">install</span> docker-ce-20.10.11-3.el7</pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token comment"># 启动 docker 并设置开机自启</span></pre></td></tr><tr><td data-num="19"></td><td><pre>systemctl <span class="token builtin class-name">enable</span> <span class="token function">docker</span> <span class="token operator">&amp;&amp;</span> systemctl start <span class="token function">docker</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token comment"># 检查 docker 版本</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token function">docker</span> -v</pre></td></tr></table></figure><h2 id="配置daemonjson文件"><a class="anchor" href="#配置daemonjson文件">#</a> 配置 daemon.json 文件</h2><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">cat</span> <span class="token operator">></span>/etc/docker/daemon.json <span class="token operator">&lt;&lt;</span><span class="token string">EOF</span></pre></td></tr><tr><td data-num="2"></td><td><pre>&#123;</pre></td></tr><tr><td data-num="3"></td><td><pre>  "exec-opts": ["native.cgroupdriver=systemd"],</pre></td></tr><tr><td data-num="4"></td><td><pre>  "log-driver": "json-file",</pre></td></tr><tr><td data-num="5"></td><td><pre>  "log-opts":&#123;</pre></td></tr><tr><td data-num="6"></td><td><pre>    "max-size": "100m"</pre></td></tr><tr><td data-num="7"></td><td><pre>  &#125;,</pre></td></tr><tr><td data-num="8"></td><td><pre>  "registry-mirrors": [</pre></td></tr><tr><td data-num="9"></td><td><pre>        "https://82m9ar63.mirror.aliyuncs.com"</pre></td></tr><tr><td data-num="10"></td><td><pre>  ]</pre></td></tr><tr><td data-num="11"></td><td><pre>&#125;</pre></td></tr><tr><td data-num="12"></td><td><pre>EOF</pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token comment"># 重启 docker</span></pre></td></tr><tr><td data-num="15"></td><td><pre>systemctl daemon-reload</pre></td></tr><tr><td data-num="16"></td><td><pre>systemctl <span class="token builtin class-name">enable</span> <span class="token function">docker</span> <span class="token operator">&amp;&amp;</span> systemctl restart <span class="token function">docker</span> <span class="token operator">&amp;&amp;</span> systemctl status <span class="token function">docker</span></pre></td></tr></table></figure><h1 id="安装kubeadm三台"><a class="anchor" href="#安装kubeadm三台">#</a> 安装 kubeadm（三台）</h1><h2 id="环境配置"><a class="anchor" href="#环境配置">#</a> 环境配置</h2><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 安装一些依赖包</span></pre></td></tr><tr><td data-num="2"></td><td><pre>yum <span class="token function">install</span> -y conntrack ntpdate ntp ipvsadm ipset jq iptables <span class="token function">curl</span> sysstat libseccomp <span class="token function">wget</span> <span class="token function">vim</span> net-tools <span class="token function">git</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># 将 SELinux 设置为 permissive 模式（相当于将其禁用）</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token function">sudo</span> setenforce <span class="token number">0</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token function">sudo</span> <span class="token function">sed</span> -i <span class="token string">'s/^SELINUX=enforcing$/SELINUX=permissive/'</span> /etc/selinux/config</pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment"># 关闭 swap</span></pre></td></tr><tr><td data-num="9"></td><td><pre>swapoff -a  </pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token function">sed</span> -ri <span class="token string">'s/.*swap.*/#&amp;/'</span> /etc/fstab</pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment"># 关闭防火墙，设置 iptables 检查桥接流量</span></pre></td></tr><tr><td data-num="13"></td><td><pre>systemctl stop firewalld <span class="token operator">&amp;&amp;</span> systemctl disable firewalld</pre></td></tr><tr><td data-num="14"></td><td><pre>yum -y <span class="token function">install</span> iptables-services <span class="token operator">&amp;&amp;</span> systemctl start iptables <span class="token operator">&amp;&amp;</span> systemctl <span class="token builtin class-name">enable</span> iptables <span class="token operator">&amp;&amp;</span> iptables -F <span class="token operator">&amp;&amp;</span> <span class="token function">service</span> iptables save </pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token function">cat</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> /etc/modules-load.d/k8s.conf</span></span></pre></td></tr><tr><td data-num="16"></td><td><pre>br_netfilter</pre></td></tr><tr><td data-num="17"></td><td><pre>EOF</pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token function">cat</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> /etc/sysctl.d/k8s.conf</span></span></pre></td></tr><tr><td data-num="20"></td><td><pre>net.bridge.bridge-nf-call-ip6tables = 1</pre></td></tr><tr><td data-num="21"></td><td><pre>net.bridge.bridge-nf-call-iptables = 1</pre></td></tr><tr><td data-num="22"></td><td><pre>EOF</pre></td></tr><tr><td data-num="23"></td><td><pre>sysctl --system</pre></td></tr></table></figure><h2 id="安装kubelet-kubeadm-kubectl"><a class="anchor" href="#安装kubelet-kubeadm-kubectl">#</a> 安装 kubelet、kubeadm、kubectl</h2><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 配置阿里源</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">cat</span>  <span class="token operator">></span> /etc/yum.repos.d/kubernetes.repo <span class="token operator">&lt;&lt;</span><span class="token string">EOF</span></pre></td></tr><tr><td data-num="3"></td><td><pre>[kubernetes]</pre></td></tr><tr><td data-num="4"></td><td><pre>name=Kubernetes</pre></td></tr><tr><td data-num="5"></td><td><pre>baseurl=http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64</pre></td></tr><tr><td data-num="6"></td><td><pre>enabled=1</pre></td></tr><tr><td data-num="7"></td><td><pre>gpgcheck=0</pre></td></tr><tr><td data-num="8"></td><td><pre>repo_gpgcheck=0</pre></td></tr><tr><td data-num="9"></td><td><pre>gpgkey=http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg </pre></td></tr><tr><td data-num="10"></td><td><pre>http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg </pre></td></tr><tr><td data-num="11"></td><td><pre>EOF</pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment"># 安装 kubelet kubeadm kubectl</span></pre></td></tr><tr><td data-num="14"></td><td><pre>yum <span class="token function">install</span> -y kubelet-1.20.11 kubectl-1.20.11 kubeadm-1.20.11</pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token comment"># systemctl 在 enable、disable、mask 子命令里面增加了 --now 选项，可以激活同时启动服务，激活同时停止服务等</span></pre></td></tr><tr><td data-num="17"></td><td><pre>systemctl <span class="token builtin class-name">enable</span> --now kubelet</pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token comment"># 查看安装的版本</span></pre></td></tr><tr><td data-num="20"></td><td><pre>kubelet --version</pre></td></tr></table></figure><p>如果想卸载 k8s 组件的话可以进行下面命令：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 卸载 K8s 组件前，先执行 kubeadm reset 命令，清空 K8s 集群设置</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token builtin class-name">echo</span> y<span class="token operator">|</span>kubeadm reset</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># 卸载管理组件</span></pre></td></tr><tr><td data-num="5"></td><td><pre>yum erase -y kubelet kubectl kubeadm kubernetes-cni</pre></td></tr></table></figure><h1 id="下载必须镜像三台"><a class="anchor" href="#下载必须镜像三台">#</a> 下载必须镜像（三台）</h1><p>本来直接用 <code>kubeadm init</code> 就行，但是由于 init 命令是从 k8s.gcr.io 网站上下载镜像，被墙了，所以需要写个脚本把这些镜像下好</p><h2 id="kubeadm-init主要执行操作"><a class="anchor" href="#kubeadm-init主要执行操作">#</a> kubeadm init 主要执行操作</h2><pre><code>[init]：指定版本进行初始化操作
[preflight] ：初始化前的检查和下载所需要的Docker镜像文件
[kubelet-start] ：生成kubelet的配置文件”/var/lib/kubelet/config.yaml”，没有这个文件kubelet无法启动，所以初始化之前的kubelet实际上启动失败。
[certificates]：生成Kubernetes使用的证书，存放在/etc/kubernetes/pki目录中。
[kubeconfig] ：生成 KubeConfig 文件，存放在/etc/kubernetes目录中，组件之间通信需要使用对应文件。
[control-plane]：使用/etc/kubernetes/manifest目录下的YAML文件，安装 Master 组件。
[etcd]：使用/etc/kubernetes/manifest/etcd.yaml安装Etcd服务。
[wait-control-plane]：等待control-plan部署的Master组件启动。
[apiclient]：检查Master组件服务状态。
[uploadconfig]：更新配置
[kubelet]：使用configMap配置kubelet。
[patchnode]：更新CNI信息到Node上，通过注释的方式记录。
[mark-control-plane]：为当前节点打标签，打了角色Master，和不可调度标签，这样默认就不会使用Master节点来运行Pod。
[bootstrap-token]：生成token记录下来，后边使用kubeadm join往集群中添加节点时会用到
[addons]：安装附加组件CoreDNS和kube-proxy 
</code></pre><h2 id="查看需要下载的镜像"><a class="anchor" href="#查看需要下载的镜像">#</a> 查看需要下载的镜像</h2><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>kubeadm config images list</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># 输出结果，这些都是 K8S 的必要组件，但是由于被墙，是不能直接 docker pull 下来的</span></pre></td></tr><tr><td data-num="4"></td><td><pre>k8s.gcr.io/kube-apiserver:v1.20.15</pre></td></tr><tr><td data-num="5"></td><td><pre>k8s.gcr.io/kube-controller-manager:v1.20.15</pre></td></tr><tr><td data-num="6"></td><td><pre>k8s.gcr.io/kube-scheduler:v1.20.15</pre></td></tr><tr><td data-num="7"></td><td><pre>k8s.gcr.io/kube-proxy:v1.20.15</pre></td></tr><tr><td data-num="8"></td><td><pre>k8s.gcr.io/pause:3.2</pre></td></tr><tr><td data-num="9"></td><td><pre>k8s.gcr.io/etcd:3.4.13-0</pre></td></tr><tr><td data-num="10"></td><td><pre>k8s.gcr.io/coredns:1.7.0</pre></td></tr></table></figure><h2 id="编写pull脚本"><a class="anchor" href="#编写pull脚本">#</a> 编写 pull 脚本</h2><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">## 位置自己确定，记住就行</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">cat</span> <span class="token operator">></span>/root/k8s-script/pull_k8s_images.sh <span class="token operator">&lt;&lt;</span> <span class="token string">"EOF"</span></pre></td></tr><tr><td data-num="3"></td><td><pre># 内容为</pre></td></tr><tr><td data-num="4"></td><td><pre>set -o errexit</pre></td></tr><tr><td data-num="5"></td><td><pre>set -o nounset</pre></td></tr><tr><td data-num="6"></td><td><pre>set -o pipefail</pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>##这里定义需要下载的版本</pre></td></tr><tr><td data-num="9"></td><td><pre>KUBE_VERSION=v1.20.15</pre></td></tr><tr><td data-num="10"></td><td><pre>KUBE_PAUSE_VERSION=3.2</pre></td></tr><tr><td data-num="11"></td><td><pre>ETCD_VERSION=3.4.13-0</pre></td></tr><tr><td data-num="12"></td><td><pre>DNS_VERSION=1.7.0</pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>##这是原来被墙的仓库</pre></td></tr><tr><td data-num="15"></td><td><pre>GCR_URL=k8s.gcr.io</pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre>##这里就是写你要使用的仓库,也可以使用gotok8s</pre></td></tr><tr><td data-num="18"></td><td><pre>DOCKERHUB_URL=registry.cn-hangzhou.aliyuncs.com/google_containers</pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre>##这里是镜像列表</pre></td></tr><tr><td data-num="21"></td><td><pre>images=(</pre></td></tr><tr><td data-num="22"></td><td><pre>kube-proxy:$&#123;KUBE_VERSION&#125;</pre></td></tr><tr><td data-num="23"></td><td><pre>kube-scheduler:$&#123;KUBE_VERSION&#125;</pre></td></tr><tr><td data-num="24"></td><td><pre>kube-controller-manager:$&#123;KUBE_VERSION&#125;</pre></td></tr><tr><td data-num="25"></td><td><pre>kube-apiserver:$&#123;KUBE_VERSION&#125;</pre></td></tr><tr><td data-num="26"></td><td><pre>pause:$&#123;KUBE_PAUSE_VERSION&#125;</pre></td></tr><tr><td data-num="27"></td><td><pre>etcd:$&#123;ETCD_VERSION&#125;</pre></td></tr><tr><td data-num="28"></td><td><pre>coredns:$&#123;DNS_VERSION&#125;</pre></td></tr><tr><td data-num="29"></td><td><pre>)</pre></td></tr><tr><td data-num="30"></td><td><pre></pre></td></tr><tr><td data-num="31"></td><td><pre>## 这里是拉取和改名的循环语句, 先下载, 再tag重命名生成需要的镜像, 再删除下载的镜像</pre></td></tr><tr><td data-num="32"></td><td><pre>for imageName in $&#123;images[@]&#125; ; do</pre></td></tr><tr><td data-num="33"></td><td><pre>  docker pull $DOCKERHUB_URL/$imageName</pre></td></tr><tr><td data-num="34"></td><td><pre>  docker tag $DOCKERHUB_URL/$imageName $GCR_URL/$imageName</pre></td></tr><tr><td data-num="35"></td><td><pre>  docker rmi $DOCKERHUB_URL/$imageName</pre></td></tr><tr><td data-num="36"></td><td><pre>done</pre></td></tr><tr><td data-num="37"></td><td><pre>EOF</pre></td></tr></table></figure><h2 id="推送脚本到node节点中"><a class="anchor" href="#推送脚本到node节点中">#</a> 推送脚本到 node 节点中</h2><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 示例</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">scp</span> /root/k8s-script/pull_k8s_images.sh root@IP地址:/root/k8s-script/</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token function">scp</span> /root/k8s-script/pull_k8s_images.sh root@121.36.55.3:/root/k8s-script/pull_k8s_images.sh</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token function">scp</span> /root/k8s-script/pull_k8s_images.sh root@124.70.19.106:/root/k8s-script/pull_k8s_images.sh</pre></td></tr></table></figure><h2 id="执行脚本"><a class="anchor" href="#执行脚本">#</a> 执行脚本</h2><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">bash</span> /root/k8s-script/pull_k8s_images.sh</pre></td></tr></table></figure><h2 id="查看下载结果"><a class="anchor" href="#查看下载结果">#</a> 查看下载结果</h2><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">docker</span> images</pre></td></tr><tr><td data-num="2"></td><td><pre>REPOSITORY                           TAG        IMAGE ID       CREATED         SIZE</pre></td></tr><tr><td data-num="3"></td><td><pre>k8s.gcr.io/kube-proxy                v1.20.15   46e2cd1b2594   <span class="token number">4</span> months ago    <span class="token number">99</span>.7MB</pre></td></tr><tr><td data-num="4"></td><td><pre>k8s.gcr.io/kube-scheduler            v1.20.15   9155e4deabb3   <span class="token number">4</span> months ago    <span class="token number">47</span>.3MB</pre></td></tr><tr><td data-num="5"></td><td><pre>k8s.gcr.io/kube-controller-manager   v1.20.15   d6296d0e06d2   <span class="token number">4</span> months ago    116MB</pre></td></tr><tr><td data-num="6"></td><td><pre>k8s.gcr.io/kube-apiserver            v1.20.15   323f6347f5e2   <span class="token number">4</span> months ago    122MB</pre></td></tr><tr><td data-num="7"></td><td><pre>k8s.gcr.io/etcd                      <span class="token number">3.4</span>.13-0   0369cf4303ff   <span class="token number">21</span> months ago   253MB</pre></td></tr><tr><td data-num="8"></td><td><pre>k8s.gcr.io/coredns                   <span class="token number">1.7</span>.0      bfe3a36ebd25   <span class="token number">23</span> months ago   <span class="token number">45</span>.2MB</pre></td></tr><tr><td data-num="9"></td><td><pre>k8s.gcr.io/pause                     <span class="token number">3.2</span>        80d28bedfe5d   <span class="token number">2</span> years ago     683kB</pre></td></tr></table></figure><h1 id="初始化主节点只有主节点"><a class="anchor" href="#初始化主节点只有主节点">#</a> 初始化主节点（只有主节点）</h1><h2 id="编辑文件"><a class="anchor" href="#编辑文件">#</a> 编辑文件</h2><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">vim</span> kubeadm-config.yaml</pre></td></tr></table></figure><figure class="highlight yaml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 修改项下面标出</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> kubeadm.k8s.io/v1beta2</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token key atrule">bootstrapTokens</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">-</span> <span class="token key atrule">groups</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token punctuation">-</span> system<span class="token punctuation">:</span>bootstrappers<span class="token punctuation">:</span>kubeadm<span class="token punctuation">:</span>default<span class="token punctuation">-</span>node<span class="token punctuation">-</span>token</pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token key atrule">token</span><span class="token punctuation">:</span> abcdef.0123456789abcdef</pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token key atrule">ttl</span><span class="token punctuation">:</span> 24h0m0s</pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token key atrule">usages</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token punctuation">-</span> signing</pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token punctuation">-</span> authentication</pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token key atrule">kind</span><span class="token punctuation">:</span> InitConfiguration</pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token key atrule">localAPIEndpoint</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token key atrule">advertiseAddress</span><span class="token punctuation">:</span> 192.168.0.194     <span class="token comment"># 本机 IP</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  <span class="token key atrule">bindPort</span><span class="token punctuation">:</span> <span class="token number">6443</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token key atrule">nodeRegistration</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="16"></td><td><pre>  <span class="token key atrule">criSocket</span><span class="token punctuation">:</span> /var/run/dockershim.sock</pre></td></tr><tr><td data-num="17"></td><td><pre>  <span class="token key atrule">name</span><span class="token punctuation">:</span> k8s<span class="token punctuation">-</span>master         <span class="token comment"># 本主机名</span></pre></td></tr><tr><td data-num="18"></td><td><pre>  <span class="token key atrule">taints</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="19"></td><td><pre>  <span class="token punctuation">-</span> <span class="token key atrule">effect</span><span class="token punctuation">:</span> NoSchedule</pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token key atrule">key</span><span class="token punctuation">:</span> node<span class="token punctuation">-</span>role.kubernetes.io/master</pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token punctuation">---</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token key atrule">apiServer</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="23"></td><td><pre>  <span class="token key atrule">timeoutForControlPlane</span><span class="token punctuation">:</span> 4m0s</pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> kubeadm.k8s.io/v1beta2</pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token key atrule">certificatesDir</span><span class="token punctuation">:</span> /etc/kubernetes/pki</pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token key atrule">clusterName</span><span class="token punctuation">:</span> kubernetes</pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token key atrule">controllerManager</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>           <span class="token comment"># 虚拟 IP 和 haproxy 端口（可以不填写）</span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token key atrule">dns</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="29"></td><td><pre>  <span class="token key atrule">type</span><span class="token punctuation">:</span> CoreDNS</pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token key atrule">etcd</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="31"></td><td><pre>  <span class="token key atrule">local</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="32"></td><td><pre>    <span class="token key atrule">dataDir</span><span class="token punctuation">:</span> /var/lib/etcd</pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token key atrule">imageRepository</span><span class="token punctuation">:</span> registry.aliyuncs.com/google_containers     <span class="token comment"># 镜像仓库源要根据自己实际情况修改</span></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterConfiguration</pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token key atrule">kubernetesVersion</span><span class="token punctuation">:</span> v1.20.15      <span class="token comment"># 修改版本，与前面版本一致，也可通过 kubeadm version 查看版本</span></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token key atrule">networking</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="37"></td><td><pre>  <span class="token key atrule">dnsDomain</span><span class="token punctuation">:</span> cluster.local</pre></td></tr><tr><td data-num="38"></td><td><pre>  <span class="token key atrule">podSubnet</span><span class="token punctuation">:</span> <span class="token string">"10.244.0.0/16"</span>    <span class="token comment"># 新增 pod 子网，固定该 IP 即可</span></pre></td></tr><tr><td data-num="39"></td><td><pre>  <span class="token key atrule">serviceSubnet</span><span class="token punctuation">:</span> 10.96.0.0/12</pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token key atrule">scheduler</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="41"></td><td><pre></pre></td></tr><tr><td data-num="42"></td><td><pre><span class="token comment"># 新增下面设置，固定即可</span></pre></td></tr><tr><td data-num="43"></td><td><pre><span class="token punctuation">---</span></pre></td></tr><tr><td data-num="44"></td><td><pre><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> kubeproxy.config.k8s.io/v1alpha1</pre></td></tr><tr><td data-num="45"></td><td><pre><span class="token key atrule">kind</span><span class="token punctuation">:</span> KubeProxyConfiguration</pre></td></tr><tr><td data-num="46"></td><td><pre><span class="token key atrule">mode</span><span class="token punctuation">:</span> ipvs</pre></td></tr></table></figure><h2 id="运行初始化命令"><a class="anchor" href="#运行初始化命令">#</a> 运行初始化命令</h2><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>kubeadm init --config<span class="token operator">=</span>kubeadm-config.yaml <span class="token operator">|</span> <span class="token function">tee</span> kubeadm-init.log</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># 正常运行结果</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span></pre></td></tr><tr><td data-num="5"></td><td><pre>Your Kubernetes control-plane has initialized successfully<span class="token operator">!</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>To start using your cluster, you need to run the following as a regular user:</pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token function">mkdir</span> -p <span class="token environment constant">$HOME</span>/.kube</pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token function">sudo</span> <span class="token function">cp</span> -i /etc/kubernetes/admin.conf <span class="token environment constant">$HOME</span>/.kube/config</pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token function">sudo</span> <span class="token function">chown</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">id</span> -u<span class="token variable">)</span></span><span class="token builtin class-name">:</span><span class="token variable"><span class="token variable">$(</span><span class="token function">id</span> -g<span class="token variable">)</span></span> <span class="token environment constant">$HOME</span>/.kube/config</pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>Alternatively, <span class="token keyword">if</span> you are the root user, you can run:</pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre>  <span class="token builtin class-name">export</span> <span class="token assign-left variable">KUBECONFIG</span><span class="token operator">=</span>/etc/kubernetes/admin.conf</pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre>You should now deploy a pod network to the cluster.</pre></td></tr><tr><td data-num="18"></td><td><pre>Run <span class="token string">"kubectl apply -f [podnetwork].yaml"</span> with one of the options listed at:</pre></td></tr><tr><td data-num="19"></td><td><pre>  https://kubernetes.io/docs/concepts/cluster-administration/addons/</pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre>Then you can <span class="token function">join</span> any number of worker nodes by running the following on each as root:</pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span></pre></td></tr></table></figure><h2 id="根据提示操作"><a class="anchor" href="#根据提示操作">#</a> 根据提示操作</h2><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 在 master 上运行</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">mkdir</span> -p <span class="token environment constant">$HOME</span>/.kube</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">sudo</span> <span class="token function">cp</span> -i /etc/kubernetes/admin.conf <span class="token environment constant">$HOME</span>/.kube/config</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token function">sudo</span> <span class="token function">chown</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">id</span> -u<span class="token variable">)</span></span><span class="token builtin class-name">:</span><span class="token variable"><span class="token variable">$(</span><span class="token function">id</span> -g<span class="token variable">)</span></span> <span class="token environment constant">$HOME</span>/.kube/config</pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment"># 推送 node &#123;1..X&#125; 机器上，如果 /root/.kube/config 没有目录要手动创建</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token function">scp</span> /etc/kubernetes/admin.conf root@121.36.55.3:/root/.kube/config</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token function">scp</span> /etc/kubernetes/admin.conf root@124.70.19.106:/root/.kube/config</pre></td></tr></table></figure><h2 id="查看当前节点状态"><a class="anchor" href="#查看当前节点状态">#</a> 查看当前节点状态</h2><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@k8s-master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get nodes</span></pre></td></tr><tr><td data-num="2"></td><td><pre>NAME         STATUS     ROLES                  AGE     VERSION</pre></td></tr><tr><td data-num="3"></td><td><pre>k8s-master   NotReady   control-plane,master   9m27s   v1.20.11</pre></td></tr></table></figure><h1 id="将子节点加入到主节点下面在子节点上操作"><a class="anchor" href="#将子节点加入到主节点下面在子节点上操作">#</a> 将子节点加入到主节点下面（在子节点上操作）</h1><p>还是在主节点的 init 命令的输出日志下，有子节点的加入命令，在两台子节点服务器上运行</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>kubeadm <span class="token function">join</span> MasterIP地址:6443 --token xxxxxx <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    --discovery-token-ca-cert-hash sha256:xxxxxx </pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">#正常运行结果</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">[</span>preflight<span class="token punctuation">]</span> Running pre-flight checks</pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token punctuation">[</span>WARNING SystemVerification<span class="token punctuation">]</span>: this Docker version is not on the list of validated versions: <span class="token number">20.10</span>.7. Latest validated version: <span class="token number">19.03</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">[</span>preflight<span class="token punctuation">]</span> Reading configuration from the cluster<span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">[</span>preflight<span class="token punctuation">]</span> FYI: You can <span class="token function">look</span> at this config <span class="token function">file</span> with <span class="token string">'kubectl -n kube-system get cm kubeadm-config -o yaml'</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">[</span>kubelet-start<span class="token punctuation">]</span> Writing kubelet configuration to <span class="token function">file</span> <span class="token string">"/var/lib/kubelet/config.yaml"</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">[</span>kubelet-start<span class="token punctuation">]</span> Writing kubelet environment <span class="token function">file</span> with flags to <span class="token function">file</span> <span class="token string">"/var/lib/kubelet/kubeadm-flags.env"</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">[</span>kubelet-start<span class="token punctuation">]</span> Starting the kubelet</pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">[</span>kubelet-start<span class="token punctuation">]</span> Waiting <span class="token keyword">for</span> the kubelet to perform the TLS Bootstrap<span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>This <span class="token function">node</span> has joined the cluster:</pre></td></tr><tr><td data-num="15"></td><td><pre>* Certificate signing request was sent to apiserver and a response was received.</pre></td></tr><tr><td data-num="16"></td><td><pre>* The Kubelet was informed of the new secure connection details.</pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre>Run <span class="token string">'kubectl get nodes'</span> on the control-plane to see this <span class="token function">node</span> <span class="token function">join</span> the cluster.</pre></td></tr></table></figure><h2 id="查看集群节点"><a class="anchor" href="#查看集群节点">#</a> 查看集群节点</h2><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>kubectl get nodes</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>root@k8s-node2 ~<span class="token punctuation">]</span><span class="token comment"># kubectl get nodes</span></pre></td></tr><tr><td data-num="4"></td><td><pre>NAME         STATUS     ROLES                  AGE     VERSION</pre></td></tr><tr><td data-num="5"></td><td><pre>k8s-master   NotReady   control-plane,master   14m     v1.20.11</pre></td></tr><tr><td data-num="6"></td><td><pre>k8s-node1    NotReady   <span class="token operator">&lt;</span>none<span class="token operator">></span>                 3m39s   v1.20.11</pre></td></tr><tr><td data-num="7"></td><td><pre>k8s-node2    NotReady   <span class="token operator">&lt;</span>none<span class="token operator">></span>                 57s     v1.20.11</pre></td></tr></table></figure><h1 id="部署flannel网络主节点操作"><a class="anchor" href="#部署flannel网络主节点操作">#</a> 部署 flannel 网络（主节点操作）</h1><h2 id="安装flannel网络插件"><a class="anchor" href="#安装flannel网络插件">#</a> 安装 flannel 网络插件</h2><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 先拉取镜像，此过程国内速度比较慢</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">docker</span> pull quay.io/coreos/flannel:v0.14.0</pre></td></tr></table></figure><h3 id="配置flannel"><a class="anchor" href="#配置flannel">#</a> 配置 flannel</h3><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 去 https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml 弄一个 yml 文件</span></pre></td></tr><tr><td data-num="2"></td><td><pre>kubectl create -f kube-flannel.yml</pre></td></tr><tr><td data-num="3"></td><td><pre>podsecuritypolicy.policy/psp.flannel.unprivileged created</pre></td></tr><tr><td data-num="4"></td><td><pre>clusterrole.rbac.authorization.k8s.io/flannel created</pre></td></tr><tr><td data-num="5"></td><td><pre>clusterrolebinding.rbac.authorization.k8s.io/flannel created</pre></td></tr><tr><td data-num="6"></td><td><pre>serviceaccount/flannel created</pre></td></tr><tr><td data-num="7"></td><td><pre>configmap/kube-flannel-cfg created</pre></td></tr><tr><td data-num="8"></td><td><pre>daemonset.apps/kube-flannel-ds created</pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment"># 查看 pod, 可以看到 flannel 组件已经运行起来了。默认系统组件都安装在 kube-system 这个命名空间 (namespace) 下</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">[</span>root@k8s-master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pod -n kube-system</span></pre></td></tr><tr><td data-num="12"></td><td><pre>NAME                                 READY   STATUS    RESTARTS   AGE</pre></td></tr><tr><td data-num="13"></td><td><pre>coredns-7f89b7bc75-6wmct             <span class="token number">1</span>/1     Running   <span class="token number">0</span>          51m</pre></td></tr><tr><td data-num="14"></td><td><pre>coredns-7f89b7bc75-nvnnr             <span class="token number">1</span>/1     Running   <span class="token number">0</span>          51m</pre></td></tr><tr><td data-num="15"></td><td><pre>etcd-k8s-master                      <span class="token number">1</span>/1     Running   <span class="token number">0</span>          51m</pre></td></tr><tr><td data-num="16"></td><td><pre>kube-apiserver-k8s-master            <span class="token number">1</span>/1     Running   <span class="token number">0</span>          51m</pre></td></tr><tr><td data-num="17"></td><td><pre>kube-controller-manager-k8s-master   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          51m</pre></td></tr><tr><td data-num="18"></td><td><pre>kube-flannel-ds-dbwqc                <span class="token number">1</span>/1     Running   <span class="token number">0</span>          12m</pre></td></tr><tr><td data-num="19"></td><td><pre>kube-flannel-ds-pfk6t                <span class="token number">1</span>/1     Running   <span class="token number">0</span>          12m</pre></td></tr><tr><td data-num="20"></td><td><pre>kube-flannel-ds-q8tkd                <span class="token number">1</span>/1     Running   <span class="token number">0</span>          12m</pre></td></tr><tr><td data-num="21"></td><td><pre>kube-proxy-jcll5                     <span class="token number">1</span>/1     Running   <span class="token number">0</span>          40m</pre></td></tr><tr><td data-num="22"></td><td><pre>kube-proxy-l68cn                     <span class="token number">1</span>/1     Running   <span class="token number">0</span>          37m</pre></td></tr><tr><td data-num="23"></td><td><pre>kube-proxy-qwf5z                     <span class="token number">1</span>/1     Running   <span class="token number">0</span>          51m</pre></td></tr><tr><td data-num="24"></td><td><pre>kube-scheduler-k8s-master            <span class="token number">1</span>/1     Running   <span class="token number">0</span>          51m</pre></td></tr><tr><td data-num="25"></td><td><pre></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token comment"># 再次查看 node, 发现状态已经变成了 Ready</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token punctuation">[</span>root@k8s-master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get node</span></pre></td></tr><tr><td data-num="28"></td><td><pre>NAME         STATUS   ROLES                  AGE   VERSION</pre></td></tr><tr><td data-num="29"></td><td><pre>k8s-master   Ready    control-plane,master   51m   v1.20.11</pre></td></tr><tr><td data-num="30"></td><td><pre>k8s-node1    Ready    <span class="token operator">&lt;</span>none<span class="token operator">></span>                 40m   v1.20.11</pre></td></tr><tr><td data-num="31"></td><td><pre>k8s-node2    Ready    <span class="token operator">&lt;</span>none<span class="token operator">></span>                 37m   v1.20.11</pre></td></tr></table></figure><p>如果想要卸载 flannel 则运行下面命令：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>kubectl delete -f kube-flannel.yml</pre></td></tr></table></figure><h1 id="参考文章"><a class="anchor" href="#参考文章">#</a> 参考文章</h1><ol><li><span class="exturl" data-url="aHR0cHM6Ly93d3cuamlhbnNodS5jb20vcC81MTU0MmIwYjIzOWI=">kubeadm 安装 k8s 集群（阿里云服务）</span></li><li><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM3MTYwMzQ2L2FydGljbGUvZGV0YWlscy8xMjA4NTEwODQ=">kubeadm 安装 k8s 集群</span></li></ol><div class="tags"><a href="/tags/%E4%BA%91%E5%8E%9F%E7%94%9F/" rel="tag"><i class="ic i-tag"></i> 云原生</a> <a href="/tags/k8s/" rel="tag"><i class="ic i-tag"></i> k8s</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2022-06-07 19:41:07" itemprop="dateModified" datetime="2022-06-07T19:41:07+08:00">2022-06-07</time> </span><span id="2022/06/07/learn-and-learn/云原生/k8s集群搭建/" class="item leancloud_visitors" data-flag-title="k8s集群搭建" title="阅读次数"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">阅读次数</span> <span class="leancloud-visitors-count"></span> <span class="text">次</span></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="蝶风 微信支付"><p>微信支付</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>蝶风 <i class="ic i-at"><em>@</em></i>永恒绿洲</li><li class="link"><strong>本文链接：</strong> <a href="https://sprenedayf.com/2022/06/07/learn-and-learn/%E4%BA%91%E5%8E%9F%E7%94%9F/k8s%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/" title="k8s集群搭建">https://sprenedayf.com/2022/06/07/learn-and-learn/云原生/k8s集群搭建/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2022/05/07/Java/%E6%93%8D%E4%BD%9C%E6%95%B0%E6%8D%AE%E5%BA%93%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%932/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;tva1.sinaimg.cn&#x2F;large&#x2F;75c23013ly8h1zx4ouw1zj20sg0g9gs9.jpg" title="操作数据库方法总结2"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> 基础知识</span><h3>操作数据库方法总结2</h3></a></div><div class="item right"><a href="/2022/06/09/learn-and-learn/%E4%BA%91%E5%8E%9F%E7%94%9F/Minio%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8%E5%9C%A8k8s%E4%B8%8A%E7%9A%84%E6%90%AD%E5%BB%BA/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;tva4.sinaimg.cn&#x2F;large&#x2F;75c23013ly8h31r9j9qbbj20sg0frq60.jpg" title="Minio对象存储在k8s上的搭建"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> 云原生</span><h3>Minio对象存储在k8s上的搭建</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%87%86%E5%A4%87"><span class="toc-number">1.</span> <span class="toc-text">服务器准备</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E5%89%8D%E6%9C%9F%E8%AE%BE%E7%BD%AE"><span class="toc-number">2.</span> <span class="toc-text">系统前期设置</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E4%B8%BB%E6%9C%BA%E5%90%8D"><span class="toc-number">2.1.</span> <span class="toc-text">设置主机名</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEhosts%E6%96%87%E4%BB%B6"><span class="toc-number">2.2.</span> <span class="toc-text">配置 hosts 文件</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%89%E8%A3%85docker"><span class="toc-number">3.</span> <span class="toc-text">安装 docker</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%B8%E8%BD%BD%E6%97%A7%E7%89%88%E6%9C%AC%E6%9C%AA%E5%AE%89%E8%A3%85%E8%BF%87%E5%88%99%E8%B7%B3%E8%BF%87"><span class="toc-number">3.1.</span> <span class="toc-text">卸载旧版本（未安装过则跳过）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E6%96%B0%E7%89%88%E6%9C%AC"><span class="toc-number">3.2.</span> <span class="toc-text">安装新版本</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEdaemonjson%E6%96%87%E4%BB%B6"><span class="toc-number">3.3.</span> <span class="toc-text">配置 daemon.json 文件</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%89%E8%A3%85kubeadm%E4%B8%89%E5%8F%B0"><span class="toc-number">4.</span> <span class="toc-text">安装 kubeadm（三台）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE"><span class="toc-number">4.1.</span> <span class="toc-text">环境配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85kubelet-kubeadm-kubectl"><span class="toc-number">4.2.</span> <span class="toc-text">安装 kubelet、kubeadm、kubectl</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%8B%E8%BD%BD%E5%BF%85%E9%A1%BB%E9%95%9C%E5%83%8F%E4%B8%89%E5%8F%B0"><span class="toc-number">5.</span> <span class="toc-text">下载必须镜像（三台）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#kubeadm-init%E4%B8%BB%E8%A6%81%E6%89%A7%E8%A1%8C%E6%93%8D%E4%BD%9C"><span class="toc-number">5.1.</span> <span class="toc-text">kubeadm init 主要执行操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E9%9C%80%E8%A6%81%E4%B8%8B%E8%BD%BD%E7%9A%84%E9%95%9C%E5%83%8F"><span class="toc-number">5.2.</span> <span class="toc-text">查看需要下载的镜像</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E5%86%99pull%E8%84%9A%E6%9C%AC"><span class="toc-number">5.3.</span> <span class="toc-text">编写 pull 脚本</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A8%E9%80%81%E8%84%9A%E6%9C%AC%E5%88%B0node%E8%8A%82%E7%82%B9%E4%B8%AD"><span class="toc-number">5.4.</span> <span class="toc-text">推送脚本到 node 节点中</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E8%84%9A%E6%9C%AC"><span class="toc-number">5.5.</span> <span class="toc-text">执行脚本</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E4%B8%8B%E8%BD%BD%E7%BB%93%E6%9E%9C"><span class="toc-number">5.6.</span> <span class="toc-text">查看下载结果</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E4%B8%BB%E8%8A%82%E7%82%B9%E5%8F%AA%E6%9C%89%E4%B8%BB%E8%8A%82%E7%82%B9"><span class="toc-number">6.</span> <span class="toc-text">初始化主节点（只有主节点）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E8%BE%91%E6%96%87%E4%BB%B6"><span class="toc-number">6.1.</span> <span class="toc-text">编辑文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C%E5%88%9D%E5%A7%8B%E5%8C%96%E5%91%BD%E4%BB%A4"><span class="toc-number">6.2.</span> <span class="toc-text">运行初始化命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%B9%E6%8D%AE%E6%8F%90%E7%A4%BA%E6%93%8D%E4%BD%9C"><span class="toc-number">6.3.</span> <span class="toc-text">根据提示操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8D%E8%8A%82%E7%82%B9%E7%8A%B6%E6%80%81"><span class="toc-number">6.4.</span> <span class="toc-text">查看当前节点状态</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B0%86%E5%AD%90%E8%8A%82%E7%82%B9%E5%8A%A0%E5%85%A5%E5%88%B0%E4%B8%BB%E8%8A%82%E7%82%B9%E4%B8%8B%E9%9D%A2%E5%9C%A8%E5%AD%90%E8%8A%82%E7%82%B9%E4%B8%8A%E6%93%8D%E4%BD%9C"><span class="toc-number">7.</span> <span class="toc-text">将子节点加入到主节点下面（在子节点上操作）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E9%9B%86%E7%BE%A4%E8%8A%82%E7%82%B9"><span class="toc-number">7.1.</span> <span class="toc-text">查看集群节点</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2flannel%E7%BD%91%E7%BB%9C%E4%B8%BB%E8%8A%82%E7%82%B9%E6%93%8D%E4%BD%9C"><span class="toc-number">8.</span> <span class="toc-text">部署 flannel 网络（主节点操作）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85flannel%E7%BD%91%E7%BB%9C%E6%8F%92%E4%BB%B6"><span class="toc-number">8.1.</span> <span class="toc-text">安装 flannel 网络插件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEflannel"><span class="toc-number">8.1.1.</span> <span class="toc-text">配置 flannel</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0"><span class="toc-number">9.</span> <span class="toc-text">参考文章</span></a></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li class="active"><a href="/2022/06/07/learn-and-learn/%E4%BA%91%E5%8E%9F%E7%94%9F/k8s%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/" rel="bookmark" title="k8s集群搭建">k8s集群搭建</a></li><li><a href="/2022/06/09/learn-and-learn/%E4%BA%91%E5%8E%9F%E7%94%9F/Minio%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8%E5%9C%A8k8s%E4%B8%8A%E7%9A%84%E6%90%AD%E5%BB%BA/" rel="bookmark" title="Minio对象存储在k8s上的搭建">Minio对象存储在k8s上的搭建</a></li><li><a href="/2022/06/10/learn-and-learn/%E4%BA%91%E5%8E%9F%E7%94%9F/Argo%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/" rel="bookmark" title="Argo环境搭建">Argo环境搭建</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="蝶风" data-src="/images/avatar.jpg"><p class="name" itemprop="name">蝶风</p><div class="description" itemprop="description">努力学习、生活</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">32</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">18</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">39</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item zhihu" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3Blb3BsZS9jaG9uZ2NvbmdjaG9uZw==" title="https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;chongcongchong"><i class="ic i-zhihu"></i></span> <span class="exturl item email" data-url="bWFpbHRvOmQxLnRiQHlhbmRleC5jb20=" title="mailto:d1.tb@yandex.com"><i class="ic i-envelope"></i></span> <span class="exturl item bilibili" data-url="aHR0cHM6Ly9zcGFjZS5iaWxpYmlsaS5jb20vMjA1Nzc1Njc/c3BtX2lkX2Zyb209MzMzLjEwMDcuMC4w" title="https:&#x2F;&#x2F;space.bilibili.com&#x2F;20577567?spm_id_from&#x3D;333.1007.0.0"><i class="ic i-bilibili"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>友链</a></li><li class="item"><a href="/talking/" rel="section"><i class="ic i-fedora"></i>说说</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2022/05/07/Java/%E6%93%8D%E4%BD%9C%E6%95%B0%E6%8D%AE%E5%BA%93%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%932/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2022/06/09/learn-and-learn/%E4%BA%91%E5%8E%9F%E7%94%9F/Minio%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8%E5%9C%A8k8s%E4%B8%8A%E7%9A%84%E6%90%AD%E5%BB%BA/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/learn-and-learn/" title="分类于 学习不止">学习不止</a> <i class="ic i-angle-right"></i> <a href="/categories/learn-and-learn/%E5%AE%9E%E4%B9%A0/" title="分类于 实习">实习</a></div><span><a href="/2022/08/13/learn-and-learn/inter-work/%E5%AE%9E%E4%B9%A0%E7%AC%AC%E4%B9%9D%E5%91%A8%E6%8A%80%E6%9C%AF%E6%80%BB%E7%BB%93/" title="实习第九周技术总结">实习第九周技术总结</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于 计算机基础">计算机基础</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/Linux/" title="分类于 Linux">Linux</a></div><span><a href="/2022/04/10/computer-science/linux%E5%AD%A6%E4%B9%A01/" title="linux学习1">linux学习1</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/learn-and-learn/" title="分类于 学习不止">学习不止</a> <i class="ic i-angle-right"></i> <a href="/categories/learn-and-learn/%E4%BA%91%E5%8E%9F%E7%94%9F/" title="分类于 云原生">云原生</a></div><span><a href="/2022/06/09/learn-and-learn/%E4%BA%91%E5%8E%9F%E7%94%9F/Minio%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8%E5%9C%A8k8s%E4%B8%8A%E7%9A%84%E6%90%AD%E5%BB%BA/" title="Minio对象存储在k8s上的搭建">Minio对象存储在k8s上的搭建</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/learn-and-learn/" title="分类于 学习不止">学习不止</a> <i class="ic i-angle-right"></i> <a href="/categories/learn-and-learn/%E5%AE%9E%E4%B9%A0/" title="分类于 实习">实习</a></div><span><a href="/2022/07/23/learn-and-learn/inter-work/%E5%AE%9E%E4%B9%A0%E7%AC%AC%E5%85%AD%E5%91%A8%E6%8A%80%E6%9C%AF%E6%80%BB%E7%BB%93/" title="实习第六周技术总结">实习第六周技术总结</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/learn-and-learn/" title="分类于 学习不止">学习不止</a> <i class="ic i-angle-right"></i> <a href="/categories/learn-and-learn/%E4%BA%91%E5%8E%9F%E7%94%9F/" title="分类于 云原生">云原生</a></div><span><a href="/2022/06/10/learn-and-learn/%E4%BA%91%E5%8E%9F%E7%94%9F/Argo%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/" title="Argo环境搭建">Argo环境搭建</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Java/" title="分类于 Java">Java</a> <i class="ic i-angle-right"></i> <a href="/categories/Java/%E4%B8%AD%E9%97%B4%E4%BB%B6/" title="分类于 中间件">中间件</a> <i class="ic i-angle-right"></i> <a href="/categories/Java/%E4%B8%AD%E9%97%B4%E4%BB%B6/Kafka/" title="分类于 Kafka">Kafka</a></div><span><a href="/2022/04/19/Java/Kafka%E7%9A%84%E5%AE%89%E8%A3%85/" title="Kafka的安装">Kafka的安装</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Java/" title="分类于 Java">Java</a> <i class="ic i-angle-right"></i> <a href="/categories/Java/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" title="分类于 基础知识">基础知识</a></div><span><a href="/2022/05/07/Java/%E6%93%8D%E4%BD%9C%E6%95%B0%E6%8D%AE%E5%BA%93%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%932/" title="操作数据库方法总结2">操作数据库方法总结2</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/learn-and-learn/" title="分类于 学习不止">学习不止</a> <i class="ic i-angle-right"></i> <a href="/categories/learn-and-learn/%E5%AE%9E%E4%B9%A0/" title="分类于 实习">实习</a></div><span><a href="/2022/07/09/learn-and-learn/inter-work/%E5%AE%9E%E4%B9%A0%E7%AC%AC%E5%9B%9B%E5%91%A8%E6%8A%80%E6%9C%AF%E6%80%BB%E7%BB%93%E4%B9%8B%E5%90%84%E7%A7%8D%E7%8E%AF%E5%A2%83%E5%8C%BA%E5%88%86/" title="实习第四周技术总结之各种环境区分">实习第四周技术总结之各种环境区分</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/learn-and-learn/" title="分类于 学习不止">学习不止</a> <i class="ic i-angle-right"></i> <a href="/categories/learn-and-learn/%E5%AE%9E%E4%B9%A0/" title="分类于 实习">实习</a></div><span><a href="/2022/06/24/learn-and-learn/inter-work/%E5%AE%9E%E4%B9%A0%E7%AC%AC%E4%BA%8C%E5%91%A8%E6%8A%80%E6%9C%AF%E6%80%BB%E7%BB%93/" title="实习第二周技术总结">实习第二周技术总结</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Java/" title="分类于 Java">Java</a> <i class="ic i-angle-right"></i> <a href="/categories/Java/%E7%BB%8F%E9%AA%8C%E6%80%BB%E7%BB%93/" title="分类于 经验总结">经验总结</a></div><span><a href="/2022/05/04/Java/%E8%AE%B0%E4%B8%80%E6%AC%A1MyBatis%E5%B0%81%E8%A3%85%E7%BB%93%E6%9E%9C%E9%9B%86java-lang-Integer-cannot-be-cast-to-java-lang-String%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/" title="记一次MyBatis封装结果集java.lang.Integer cannot be cast to java.lang.String异常处理">记一次MyBatis封装结果集java.lang.Integer cannot be cast to java.lang.String异常处理</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; <span itemprop="copyrightYear">2022</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">蝶风 @ TheOnly-DF</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">177k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">4:01</span></div><span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span><script>function createtime(){var n=new Date("04/09/2022 17:38:00");now.setTime(now.getTime()+250),days=(now-n)/1e3/60/60/24,dnum=Math.floor(days),hours=(now-n)/1e3/60/60-24*dnum,hnum=Math.floor(hours),1==String(hnum).length&&(hnum="0"+hnum),minutes=(now-n)/1e3/60-1440*dnum-60*hnum,mnum=Math.floor(minutes),1==String(mnum).length&&(mnum="0"+mnum),seconds=(now-n)/1e3-86400*dnum-3600*hnum-60*mnum,snum=Math.round(seconds),1==String(snum).length&&(snum="0"+snum),document.getElementById("timeDate").innerHTML="本站已安全运行 "+dnum+" 天 ",document.getElementById("times").innerHTML=hnum+" 小时 "+mnum+" 分 "+snum+" 秒  "}var now=new Date;setInterval("createtime()",250)</script><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2022/06/07/learn-and-learn/云原生/k8s集群搭建/",favicon:{show:"ヽ( o･ｪ･)ﾉ欢迎回来~",hide:"•﹏•再见~"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//fastly.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html><!-- rebuild by hrmmi -->