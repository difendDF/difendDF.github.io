<!-- build time:Sat Jun 18 2022 23:00:43 GMT+0800 (中国标准时间) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="永恒绿洲" href="https://sprenedayf.com/rss.xml"><link rel="alternate" type="application/atom+xml" title="永恒绿洲" href="https://sprenedayf.com/atom.xml"><link rel="alternate" type="application/json" title="永恒绿洲" href="https://sprenedayf.com/feed.json"><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/artitalk"></script><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="中间件,框架,Kafka"><link rel="canonical" href="https://sprenedayf.com/2022/04/19/Java/Kafka%E7%9A%84%E5%AE%89%E8%A3%85/"><title>Kafka的安装 - Kafka - 中间件 - Java | TheOnly-DF = 永恒绿洲 = 虽然不容易，只要去做，就能成功</title><meta name="generator" content="Hexo 5.4.2"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">Kafka的安装</h1><div class="meta"><span class="item" title="创建时间：2022-04-19 11:22:00"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2022-04-19T11:22:00+08:00">2022-04-19</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>7.6k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>10 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">TheOnly-DF</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://tva1.sinaimg.cn/large/6833939bly1gipevarprfj20zk0m8npd.jpg"></li><li class="item" data-background-image="https://tva1.sinaimg.cn/large/6833939bly1giciszlczyj20zk0m816d.jpg"></li><li class="item" data-background-image="https://tva1.sinaimg.cn/large/6833939bly1gipeu7txpzj20zk0m81kx.jpg"></li><li class="item" data-background-image="https://tva1.sinaimg.cn/large/75c23013ly8h26kml3041j20j60csq55.jpg"></li><li class="item" data-background-image="https://tva1.sinaimg.cn/large/6833939bly1gicitht3xtj20zk0m8k5v.jpg"></li><li class="item" data-background-image="https://tva1.sinaimg.cn/large/6833939bly1giclwuom7cj20zk0m8dvn.jpg"></li></ul></div><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div></header><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/Java/" itemprop="item" rel="index" title="分类于 Java"><span itemprop="name">Java</span></a><meta itemprop="position" content="1"></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/Java/%E4%B8%AD%E9%97%B4%E4%BB%B6/" itemprop="item" rel="index" title="分类于 中间件"><span itemprop="name">中间件</span></a><meta itemprop="position" content="2"></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/Java/%E4%B8%AD%E9%97%B4%E4%BB%B6/Kafka/" itemprop="item" rel="index" title="分类于 Kafka"><span itemprop="name">Kafka</span></a><meta itemprop="position" content="3"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://sprenedayf.com/2022/04/19/Java/Kafka%E7%9A%84%E5%AE%89%E8%A3%85/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="蝶风"><meta itemprop="description" content="虽然不容易，只要去做，就能成功, 努力学习、生活"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="永恒绿洲"></span><div class="body md" itemprop="articleBody"><h1 id="利用docker安装"><a class="anchor" href="#利用docker安装">#</a> 利用 Docker 安装</h1><p>之前我说过，我希望能够快速开始实践，所以选择了利用 docker 来安装组件，docker-compose 来解决通信问题，这次也一样，先用 docker 安装一个 kafka 集群来上手玩玩，之后有时间会再从头到尾搭建一遍集群的。</p><h2 id="创建一个docker网络"><a class="anchor" href="#创建一个docker网络">#</a> 创建一个 docker 网络</h2><p>通过 <code>docker network create zookeeper_network</code> 命令创建一个名为 <code>zookeeper_network</code> 的 Docker 网络<br>这时候你利用 <code>docker network ls</code> 可以看到创建出来了<br><img data-src="https://tva3.sinaimg.cn/large/006yBBDDly8h1f0wunn90j30wm08egms.jpg" alt="" height="250px"></p><h2 id="搭建zookeeper集群"><a class="anchor" href="#搭建zookeeper集群">#</a> 搭建 zookeeper 集群</h2><p>为了解耦，我们把 zookeeper 集群和 kafka 集群成两个 docker-compose.yml 文件</p><figure class="highlight yml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3.8'</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token key atrule">networks</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token key atrule">default</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token key atrule">external</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>      <span class="token key atrule">name</span><span class="token punctuation">:</span> zookeeper_network</pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token key atrule">services</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token key atrule">zoo1</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token key atrule">image</span><span class="token punctuation">:</span> zookeeper<span class="token punctuation">:</span>3.7.0</pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> zoo1</pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> zoo1</pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token key atrule">ports</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="14"></td><td><pre>      <span class="token punctuation">-</span> 2181<span class="token punctuation">:</span><span class="token number">2181</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token key atrule">volumes</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="16"></td><td><pre>      <span class="token punctuation">-</span> <span class="token string">"/root/kafka_learn/zookeeper/zoo1/data:/data"</span></pre></td></tr><tr><td data-num="17"></td><td><pre>      <span class="token punctuation">-</span> <span class="token string">"/root/kafka_learn/zookeeper/zoo1/datalog:/datalog"</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token key atrule">environment</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="19"></td><td><pre>      <span class="token key atrule">ZOO_MY_ID</span><span class="token punctuation">:</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="20"></td><td><pre>      <span class="token key atrule">ZOO_SERVERS</span><span class="token punctuation">:</span> server.1=0.0.0.0<span class="token punctuation">:</span>2888<span class="token punctuation">:</span>3888;2181 server.2=zoo2<span class="token punctuation">:</span>2888<span class="token punctuation">:</span>3888;2181 server.3=zoo3<span class="token punctuation">:</span>2888<span class="token punctuation">:</span>3888;2181</pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre>  <span class="token key atrule">zoo2</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token key atrule">image</span><span class="token punctuation">:</span> zookeeper<span class="token punctuation">:</span>3.7.0</pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> zoo2</pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> zoo2</pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token key atrule">ports</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="27"></td><td><pre>      <span class="token punctuation">-</span> 2182<span class="token punctuation">:</span><span class="token number">2181</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token key atrule">volumes</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="29"></td><td><pre>      <span class="token punctuation">-</span> <span class="token string">"/root/kafka_learn/zookeeper/zoo2/data:/data"</span></pre></td></tr><tr><td data-num="30"></td><td><pre>      <span class="token punctuation">-</span> <span class="token string">"/root/kafka_learn/zookeeper/zoo2/datalog:/datalog"</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token key atrule">environment</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="32"></td><td><pre>      <span class="token key atrule">ZOO_MY_ID</span><span class="token punctuation">:</span> <span class="token number">2</span></pre></td></tr><tr><td data-num="33"></td><td><pre>      <span class="token key atrule">ZOO_SERVERS</span><span class="token punctuation">:</span> server.1=zoo1<span class="token punctuation">:</span>2888<span class="token punctuation">:</span>3888;2181 server.2=0.0.0.0<span class="token punctuation">:</span>2888<span class="token punctuation">:</span>3888;2181 server.3=zoo3<span class="token punctuation">:</span>2888<span class="token punctuation">:</span>3888;2181</pre></td></tr><tr><td data-num="34"></td><td><pre></pre></td></tr><tr><td data-num="35"></td><td><pre>  <span class="token key atrule">zoo3</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="36"></td><td><pre>    <span class="token key atrule">image</span><span class="token punctuation">:</span> zookeeper<span class="token punctuation">:</span>3.7.0</pre></td></tr><tr><td data-num="37"></td><td><pre>    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> zoo3</pre></td></tr><tr><td data-num="38"></td><td><pre>    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> zoo3</pre></td></tr><tr><td data-num="39"></td><td><pre>    <span class="token key atrule">ports</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="40"></td><td><pre>      <span class="token punctuation">-</span> 2183<span class="token punctuation">:</span><span class="token number">2181</span></pre></td></tr><tr><td data-num="41"></td><td><pre>    <span class="token key atrule">volumes</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="42"></td><td><pre>      <span class="token punctuation">-</span> <span class="token string">"/root/kafka_learn/zookeeper/zoo3/data:/data"</span></pre></td></tr><tr><td data-num="43"></td><td><pre>      <span class="token punctuation">-</span> <span class="token string">"/root/kafka_learn/zookeeper/zoo3/datalog:/datalog"</span></pre></td></tr><tr><td data-num="44"></td><td><pre>    <span class="token key atrule">environment</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="45"></td><td><pre>      <span class="token key atrule">ZOO_MY_ID</span><span class="token punctuation">:</span> <span class="token number">3</span></pre></td></tr><tr><td data-num="46"></td><td><pre>      <span class="token key atrule">ZOO_SERVERS</span><span class="token punctuation">:</span> server.1=zoo1<span class="token punctuation">:</span>2888<span class="token punctuation">:</span>3888;2181 server.2=zoo2<span class="token punctuation">:</span>2888<span class="token punctuation">:</span>3888;2181 server.3=0.0.0.0<span class="token punctuation">:</span>2888<span class="token punctuation">:</span>3888;2181</pre></td></tr></table></figure><p>然后利用 <code>docker-compose up -d</code> 启动 zookeeper 集群</p><h2 id="搭建kafka集群"><a class="anchor" href="#搭建kafka集群">#</a> 搭建 kafka 集群</h2><figure class="highlight yml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3.8'</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token key atrule">networks</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token key atrule">default</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token key atrule">external</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>      <span class="token key atrule">name</span><span class="token punctuation">:</span> zookeeper_network</pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token key atrule">services</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token key atrule">kafka1</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token key atrule">image</span><span class="token punctuation">:</span> wurstmeister/kafka<span class="token punctuation">:</span>2.12<span class="token punctuation">-</span>2.4.1</pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token key atrule">restart</span><span class="token punctuation">:</span> unless<span class="token punctuation">-</span>stopped</pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> kafka1</pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> kafka1</pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token key atrule">ports</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="15"></td><td><pre>      <span class="token punctuation">-</span> <span class="token string">"9092:9092"</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token key atrule">external_links</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="17"></td><td><pre>      <span class="token punctuation">-</span> zoo1</pre></td></tr><tr><td data-num="18"></td><td><pre>      <span class="token punctuation">-</span> zoo2</pre></td></tr><tr><td data-num="19"></td><td><pre>      <span class="token punctuation">-</span> zoo3</pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token key atrule">environment</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="21"></td><td><pre>      <span class="token key atrule">KAFKA_BROKER_ID</span><span class="token punctuation">:</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="22"></td><td><pre>      <span class="token key atrule">KAFKA_LISTENERS</span><span class="token punctuation">:</span> PLAINTEXT<span class="token punctuation">:</span>//0.0.0.0<span class="token punctuation">:</span><span class="token number">9092</span></pre></td></tr><tr><td data-num="23"></td><td><pre>      <span class="token key atrule">KAFKA_ADVERTISED_LISTENERS</span><span class="token punctuation">:</span> PLAINTEXT<span class="token punctuation">:</span>//192.168.0.225<span class="token punctuation">:</span><span class="token number">9092</span>    <span class="token comment">## 宿主机 IP</span></pre></td></tr><tr><td data-num="24"></td><td><pre>      <span class="token key atrule">KAFKA_ADVERTISED_HOST_NAME</span><span class="token punctuation">:</span> kafka1</pre></td></tr><tr><td data-num="25"></td><td><pre>      <span class="token key atrule">KAFKA_ADVERTISED_PORT</span><span class="token punctuation">:</span> <span class="token number">9092</span></pre></td></tr><tr><td data-num="26"></td><td><pre>      <span class="token key atrule">KAFKA_ZOOKEEPER_CONNECT</span><span class="token punctuation">:</span> <span class="token string">"zoo1:2181,zoo2:2181,zoo3:2181"</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token key atrule">volumes</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="28"></td><td><pre>      <span class="token punctuation">-</span> <span class="token string">"/root/kafka_learn/kafka/kafka1/data/:/kafka"</span></pre></td></tr><tr><td data-num="29"></td><td><pre></pre></td></tr><tr><td data-num="30"></td><td><pre></pre></td></tr><tr><td data-num="31"></td><td><pre>  <span class="token key atrule">kafka2</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="32"></td><td><pre>    <span class="token key atrule">image</span><span class="token punctuation">:</span> wurstmeister/kafka<span class="token punctuation">:</span>2.12<span class="token punctuation">-</span>2.4.1</pre></td></tr><tr><td data-num="33"></td><td><pre>    <span class="token key atrule">restart</span><span class="token punctuation">:</span> unless<span class="token punctuation">-</span>stopped</pre></td></tr><tr><td data-num="34"></td><td><pre>    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> kafka2</pre></td></tr><tr><td data-num="35"></td><td><pre>    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> kafka2</pre></td></tr><tr><td data-num="36"></td><td><pre>    <span class="token key atrule">ports</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="37"></td><td><pre>      <span class="token punctuation">-</span> <span class="token string">"9093:9092"</span></pre></td></tr><tr><td data-num="38"></td><td><pre>    <span class="token key atrule">external_links</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="39"></td><td><pre>      <span class="token punctuation">-</span> zoo1</pre></td></tr><tr><td data-num="40"></td><td><pre>      <span class="token punctuation">-</span> zoo2</pre></td></tr><tr><td data-num="41"></td><td><pre>      <span class="token punctuation">-</span> zoo3</pre></td></tr><tr><td data-num="42"></td><td><pre>    <span class="token key atrule">environment</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="43"></td><td><pre>      <span class="token key atrule">KAFKA_BROKER_ID</span><span class="token punctuation">:</span> <span class="token number">2</span></pre></td></tr><tr><td data-num="44"></td><td><pre>      <span class="token key atrule">KAFKA_LISTENERS</span><span class="token punctuation">:</span> PLAINTEXT<span class="token punctuation">:</span>//0.0.0.0<span class="token punctuation">:</span><span class="token number">9092</span></pre></td></tr><tr><td data-num="45"></td><td><pre>      <span class="token key atrule">KAFKA_ADVERTISED_LISTENERS</span><span class="token punctuation">:</span> PLAINTEXT<span class="token punctuation">:</span>//192.168.0.225<span class="token punctuation">:</span><span class="token number">9093</span>    <span class="token comment">## 宿主机 IP</span></pre></td></tr><tr><td data-num="46"></td><td><pre>      <span class="token key atrule">KAFKA_ADVERTISED_HOST_NAME</span><span class="token punctuation">:</span> kafka2</pre></td></tr><tr><td data-num="47"></td><td><pre>      <span class="token key atrule">KAFKA_ADVERTISED_PORT</span><span class="token punctuation">:</span> <span class="token number">9093</span></pre></td></tr><tr><td data-num="48"></td><td><pre>      <span class="token key atrule">KAFKA_ZOOKEEPER_CONNECT</span><span class="token punctuation">:</span> <span class="token string">"zoo1:2181,zoo2:2181,zoo3:2181"</span></pre></td></tr><tr><td data-num="49"></td><td><pre>    <span class="token key atrule">volumes</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="50"></td><td><pre>      <span class="token punctuation">-</span> <span class="token string">"/root/kafka_learn/kafka/kafka2/data/:/kafka"</span></pre></td></tr><tr><td data-num="51"></td><td><pre></pre></td></tr><tr><td data-num="52"></td><td><pre>  <span class="token key atrule">kafka3</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="53"></td><td><pre>    <span class="token key atrule">image</span><span class="token punctuation">:</span> wurstmeister/kafka<span class="token punctuation">:</span>2.12<span class="token punctuation">-</span>2.4.1</pre></td></tr><tr><td data-num="54"></td><td><pre>    <span class="token key atrule">restart</span><span class="token punctuation">:</span> unless<span class="token punctuation">-</span>stopped</pre></td></tr><tr><td data-num="55"></td><td><pre>    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> kafka3</pre></td></tr><tr><td data-num="56"></td><td><pre>    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> kafka3</pre></td></tr><tr><td data-num="57"></td><td><pre>    <span class="token key atrule">ports</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="58"></td><td><pre>      <span class="token punctuation">-</span> <span class="token string">"9094:9092"</span></pre></td></tr><tr><td data-num="59"></td><td><pre>    <span class="token key atrule">external_links</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="60"></td><td><pre>      <span class="token punctuation">-</span> zoo1</pre></td></tr><tr><td data-num="61"></td><td><pre>      <span class="token punctuation">-</span> zoo2</pre></td></tr><tr><td data-num="62"></td><td><pre>      <span class="token punctuation">-</span> zoo3</pre></td></tr><tr><td data-num="63"></td><td><pre>    <span class="token key atrule">environment</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="64"></td><td><pre>      <span class="token key atrule">KAFKA_BROKER_ID</span><span class="token punctuation">:</span> <span class="token number">3</span></pre></td></tr><tr><td data-num="65"></td><td><pre>      <span class="token key atrule">KAFKA_LISTENERS</span><span class="token punctuation">:</span> PLAINTEXT<span class="token punctuation">:</span>//0.0.0.0<span class="token punctuation">:</span><span class="token number">9092</span></pre></td></tr><tr><td data-num="66"></td><td><pre>      <span class="token key atrule">KAFKA_ADVERTISED_LISTENERS</span><span class="token punctuation">:</span> PLAINTEXT<span class="token punctuation">:</span>//192.168.0.225<span class="token punctuation">:</span><span class="token number">9094</span>   <span class="token comment">## 宿主机 IP</span></pre></td></tr><tr><td data-num="67"></td><td><pre>      <span class="token key atrule">KAFKA_ADVERTISED_HOST_NAME</span><span class="token punctuation">:</span> kafka3</pre></td></tr><tr><td data-num="68"></td><td><pre>      <span class="token key atrule">KAFKA_ADVERTISED_PORT</span><span class="token punctuation">:</span> <span class="token number">9094</span></pre></td></tr><tr><td data-num="69"></td><td><pre>      <span class="token key atrule">KAFKA_ZOOKEEPER_CONNECT</span><span class="token punctuation">:</span> <span class="token string">"zoo1:2181,zoo2:2181,zoo3:2181"</span></pre></td></tr><tr><td data-num="70"></td><td><pre>    <span class="token key atrule">volumes</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="71"></td><td><pre>      <span class="token punctuation">-</span> <span class="token string">"/root/kafka_learn/kafka/kafka3/data/:/kafka"</span></pre></td></tr><tr><td data-num="72"></td><td><pre></pre></td></tr><tr><td data-num="73"></td><td><pre>  <span class="token key atrule">kafka-manager</span><span class="token punctuation">:</span> <span class="token comment"># Kafka 图形管理界面</span></pre></td></tr><tr><td data-num="74"></td><td><pre>    <span class="token key atrule">image</span><span class="token punctuation">:</span> sheepkiller/kafka<span class="token punctuation">-</span>manager<span class="token punctuation">:</span>latest</pre></td></tr><tr><td data-num="75"></td><td><pre>    <span class="token key atrule">restart</span><span class="token punctuation">:</span> unless<span class="token punctuation">-</span>stopped</pre></td></tr><tr><td data-num="76"></td><td><pre>    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> kafka<span class="token punctuation">-</span>manager</pre></td></tr><tr><td data-num="77"></td><td><pre>    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> kafka<span class="token punctuation">-</span>manager</pre></td></tr><tr><td data-num="78"></td><td><pre>    <span class="token key atrule">ports</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="79"></td><td><pre>      <span class="token punctuation">-</span> <span class="token string">"9000:9000"</span></pre></td></tr><tr><td data-num="80"></td><td><pre>    <span class="token key atrule">links</span><span class="token punctuation">:</span>            <span class="token comment"># 连接本 compose 文件创建的 container</span></pre></td></tr><tr><td data-num="81"></td><td><pre>      <span class="token punctuation">-</span> kafka1</pre></td></tr><tr><td data-num="82"></td><td><pre>      <span class="token punctuation">-</span> kafka2</pre></td></tr><tr><td data-num="83"></td><td><pre>      <span class="token punctuation">-</span> kafka3</pre></td></tr><tr><td data-num="84"></td><td><pre>    <span class="token key atrule">external_links</span><span class="token punctuation">:</span>   <span class="token comment"># 连接外部 compose 文件创建的 container</span></pre></td></tr><tr><td data-num="85"></td><td><pre>      <span class="token punctuation">-</span> zoo1</pre></td></tr><tr><td data-num="86"></td><td><pre>      <span class="token punctuation">-</span> zoo2</pre></td></tr><tr><td data-num="87"></td><td><pre>      <span class="token punctuation">-</span> zoo3</pre></td></tr><tr><td data-num="88"></td><td><pre>    <span class="token key atrule">environment</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="89"></td><td><pre>      <span class="token key atrule">ZK_HOSTS</span><span class="token punctuation">:</span> zoo1<span class="token punctuation">:</span><span class="token number">2181</span><span class="token punctuation">,</span>zoo2<span class="token punctuation">:</span><span class="token number">2181</span><span class="token punctuation">,</span>zoo3<span class="token punctuation">:</span><span class="token number">2181</span></pre></td></tr><tr><td data-num="90"></td><td><pre>      <span class="token key atrule">KAFKA_BROKERS</span><span class="token punctuation">:</span> kafka1<span class="token punctuation">:</span><span class="token number">9092</span><span class="token punctuation">,</span>kafka2<span class="token punctuation">:</span><span class="token number">9093</span><span class="token punctuation">,</span>kafka3<span class="token punctuation">:</span><span class="token number">9094</span></pre></td></tr></table></figure><p>然后利用 <code>docker-compose up -d</code> 启动 kafka 集群</p><h2 id="测试一下"><a class="anchor" href="#测试一下">#</a> 测试一下</h2><ol><li>首先我们用 <code>docker ps</code> 看看启动起来没有<br><img data-src="https://tva2.sinaimg.cn/large/006yBBDDly8h1f15k3xdrj32ew0iujwj.jpg" alt="" height="400px"><br>看样子是没问题了</li><li>利用 <code>服务器ip:9000</code> 的形式访问一下我们的 kafka manager 界面，配置一下我们的集群<br><img data-src="https://tva4.sinaimg.cn/large/006yBBDDly8h1f17cgqhfj30ws0qiq4m.jpg" alt="" height="450px"></li><li>创建一个 topic 来测试一下，创建 topic 名为 test，设置 partition 为 3，replica 数为 3<span class="red">【这里注意，你的同一个 partition 的 Replica 数量不能多于 broker 数量，因为多了也是在同一个 broker 上放两个副本，挂了也是都没了没意义啊】</span><br><img data-src="https://tva1.sinaimg.cn/large/006yBBDDly8h1f1d5b6nvj31ri0cgabp.jpg" alt="" height="350px"><br>可以看到不同 partition 的 leader 是均匀分布在 broker 上的，并且每个 partition 的副本在每个 broker 上都有</li><li>启动生产者和消费者，这里我用 kafka1 来当生产者，kafka2 来当消费者</li></ol><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">docker</span> <span class="token builtin class-name">exec</span> -it kafka1 /bin/bash</pre></td></tr><tr><td data-num="2"></td><td><pre>kafka-console-producer.sh --broker-list kafka1:9092,kafka2:9092,kafka3:9092 --topic <span class="token builtin class-name">test</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">></span>msg1</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">></span>msg2</pre></td></tr></table></figure><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">docker</span> <span class="token builtin class-name">exec</span> -it kafka2 /bin/bash</pre></td></tr><tr><td data-num="2"></td><td><pre>kafka-console-consumer.sh --bootstrap-server kafka1:9092,kafka2:9092,kafka3:9092 --topic <span class="token builtin class-name">test</span> --from-beginning</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>msg1</pre></td></tr><tr><td data-num="5"></td><td><pre>msg2</pre></td></tr></table></figure><p>你自己演示下，生产者那边生产了一消息后，消费者这边就出现一条新消息</p><h2 id="20220420更新修正"><a class="anchor" href="#20220420更新修正">#</a> 2022.04.20 更新修正</h2><p>上面搭建的 kafka 集群进入容器里面进行生产者和消费者测试都是没有问题的，但是在我利用 kafka tools 连接和利用 java 连接的时候发现无论如何都连接不上，所以考虑到是我外界应用无法连接 docker 内的应用，开始 debug。<br>我用的是华为云的服务器，公网 ip 是 123.xxxxxx 内网 ip 是 192.xxxxxx，上面我的配置是 <code>KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://192.168.0.225:9093</code> 这里用了内网 ip，那么我们现在改成公网 ip 试一试，发现出现了新的问题 <code>Broker may not be available</code> .........<br><img data-src="https://tva3.sinaimg.cn/large/006yBBDDly8h1fzns8wf7j30d30d33z3.jpg" alt="" height="150px"><br>行吧，抱着不解决就不睡觉的心思，耐心去看了解决方案和文档，发现了答案 ——</p><h3 id="docker与直接部署的区别"><a class="anchor" href="#docker与直接部署的区别">#</a> docker 与直接部署的区别</h3><p>直接部署的时候我们 kafka 的参数设置是这样的形式:</p><figure class="highlight properties"><figcaption data-lang=".properties"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token attr-name">broker.id</span><span class="token punctuation">=</span><span class="token attr-value">1</span></pre></td></tr><tr><td data-num="2"></td><td><pre> </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># 监听端口指定为 9093</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token attr-name">listeners</span><span class="token punctuation">=</span><span class="token attr-value">PLAINTEXT://:9093</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># 对外部暴露端口     本机 IP: 端口</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token attr-name">advertised.listeners</span><span class="token punctuation">=</span><span class="token attr-value">PLAINTEXT://192.168.206.155:9093</span></pre></td></tr><tr><td data-num="7"></td><td><pre> </pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token attr-name">num.network.threads</span><span class="token punctuation">=</span><span class="token attr-value">3</span></pre></td></tr><tr><td data-num="9"></td><td><pre> </pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token attr-name">num.io.threads</span><span class="token punctuation">=</span><span class="token attr-value">8</span></pre></td></tr><tr><td data-num="11"></td><td><pre> </pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token attr-name">socket.send.buffer.bytes</span><span class="token punctuation">=</span><span class="token attr-value">102400</span></pre></td></tr><tr><td data-num="13"></td><td><pre> </pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token attr-name">socket.receive.buffer.bytes</span><span class="token punctuation">=</span><span class="token attr-value">102400</span></pre></td></tr><tr><td data-num="15"></td><td><pre> </pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token attr-name">socket.request.max.bytes</span><span class="token punctuation">=</span><span class="token attr-value">104857600</span></pre></td></tr><tr><td data-num="17"></td><td><pre> </pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token attr-name">log.dirs</span><span class="token punctuation">=</span><span class="token attr-value">/tmp/kafka-logs-1</span></pre></td></tr></table></figure><p>而我们 docker-compose.yml 文件中配置项是这样的形式：</p><figure class="highlight yml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token key atrule">environment</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token key atrule">KAFKA_BROKER_ID</span><span class="token punctuation">:</span> <span class="token number">2</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token key atrule">KAFKA_LISTENERS</span><span class="token punctuation">:</span> PLAINTEXT<span class="token punctuation">:</span>//0.0.0.0<span class="token punctuation">:</span><span class="token number">9092</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token key atrule">KAFKA_ADVERTISED_LISTENERS</span><span class="token punctuation">:</span> PLAINTEXT<span class="token punctuation">:</span>//192.168.0225<span class="token punctuation">:</span><span class="token number">9093</span>    <span class="token comment">## 宿主机 IP</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token key atrule">KAFKA_ADVERTISED_HOST_NAME</span><span class="token punctuation">:</span> kafka2</pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token key atrule">KAFKA_ADVERTISED_PORT</span><span class="token punctuation">:</span> <span class="token number">9093</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token key atrule">KAFKA_ZOOKEEPER_CONNECT</span><span class="token punctuation">:</span> <span class="token string">"zoo1:2181,zoo2:2181,zoo3:2181"</span></pre></td></tr></table></figure><p>所以其实就是在原来 kafka 配置上全部大写， <code>.</code> 变 <code>_</code> ，然后加了个 KAFKA 前缀</p><h3 id="listeners与advertisedlisteners的区别"><a class="anchor" href="#listeners与advertisedlisteners的区别">#</a> listeners 与 advertised.listeners 的区别</h3><p>可以看到我们在配置的时候设置了两个 listener，那么他们分别是干嘛的呢？</p><div class="note info no-icon"><p><strong><span class="exturl" data-url="aHR0cDovL2FkdmVydGlzZWQuaG9zdC5uYW1l">advertised.host.name</span></strong>: DEPRECATED: only used when advertised.listeners or listeners are not set. Use advertised.listeners instead. Hostname to publish to ZooKeeper for clients to use. In IaaS environments, this may need to be different from the interface to which the broker binds. If this is not set, it will use the value for <span class="exturl" data-url="aHR0cDovL2hvc3QubmFtZQ==">host.name</span> if configured. Otherwise it will use the value returned from java.net.InetAddress.getCanonicalHostName().<br><strong>advertised.listeners</strong>: Listeners to publish to ZooKeeper for clients to use, if different than the listeners config property. In IaaS environments, this may need to be different from the interface to which the broker binds. If this is not set, the value for listeners will be used. Unlike listeners it is not valid to advertise the 0.0.0.0 meta-address.</p></div><p>解释以下就是说如果没有设置任何的 <code>listener</code> 参数，那么就会利用 hostname 和 port 来上报使用，如果设置了 <code>listener</code> 参数就利用 <code>listener</code> 参数中的值来使用，而 <code>listeners</code> 和 <code>advertised.listeners</code> 是为了区分内网和外网的，如果只有内网就可以只是用 <code>listeners</code> ，如果涉及了外网，比如要在云服务器上部署使用就需要用到 <code>advertised.listeners</code> 参数了。<br>那么我们现在内网设置的内容是 <code>KAFKA_LISTENERS: PLAINTEXT://0.0.0.0:9092</code> ，想要外网访问就可以设置为 <code>KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://&lt;服务器ip&gt;:&lt;暴露端口&gt;</code> 。 <code>advertised.listeners</code> ， 用于开发给用户，如果没有设定，直接使用 <code>listeners</code> , 而我们的 <code>listeners</code> 是监控的 <code>0.0.0.0</code> 这外界怎么可能访问的通嘛！<br><img data-src="https://tva1.sinaimg.cn/large/006yBBDDly8h1g0c1pgdij30c80d0mxh.jpg" alt="" height="150px"></p><h3 id="java程序与advertisedlisteners的关系"><a class="anchor" href="#java程序与advertisedlisteners的关系">#</a> java 程序与 advertised.listeners 的关系</h3><p>这个问题我们首先需要知道 zookeeper 在 kafka 中的用处，我简单的提一个现在和我们现在密切相关的用处 ——<strong>Broker 注册</strong><br>Broker 是分布式部署并且相互之间相互独立，但是需要有一个注册系统能够将整个集群中的 Broker 管理起来，此时就使用到了 Zookeeper。在 Zookeeper 上会有一个专门用来进行 Broker 服务器列表记录的节点： <code>/brokers/ids</code><br>我们来验证一下，首先利用 <code>docker exec -it zoo1 /bin/sh</code> 进入到 zoo1 节点中，然后 <code>zkCli.sh</code> 一下，利用 <code>ls /brokers/ids</code> 命令来查看我们 yml 文件中创建的三个 broker 节点<br><img data-src="https://tva1.sinaimg.cn/large/006yBBDDly8h1g0y1dt4kj30qs02ajrd.jpg" alt="" height="100px"><br>然后我们看看每个节点里面都存了什么数据 <code>get /brokers/ids/1</code></p><pre><code>&#123;&quot;listener_security_protocol_map&quot;:&#123;&quot;PLAINTEXT&quot;:&quot;PLAINTEXT&quot;&#125;,&quot;endpoints&quot;:[&quot;PLAINTEXT://123.xxxxxxx:9092&quot;],&quot;jmx_port&quot;:-1,&quot;host&quot;:&quot;123.xxxxxxxx&quot;,&quot;timestamp&quot;:&quot;1650424784738&quot;,&quot;port&quot;:9092,&quot;version&quot;:4&#125;
</code></pre><p><span class="red">Kafka 客户端在连接 Broker 的时候，Broker 将客户端发来的请求附加信息与 Broker 启动时上报给 Zookeeper 的 listeners 参数信息、host（来自 listeners 的中间域名或主机名部分）、port (来自 listeners 的端口部分) 进行了验证，认证通过建立连接执行请求，反之建立连接失败</span><br>【就是说如果你在 <code>advertised.listeners</code> 中配置了什么内容在 zookeeper 节点中就是 endpoints 中的内容，然后连接的时候就严格按照 endpoints 中的内容来进行匹配，不同就不让你连】<br>这样就很好的解释了为什么有的博客里面说要用 <code>advertised.listeners=PLAINTEXT://kafka1:9092</code> 来配置在 java 程序中就需要配置为 <code>kafka1:9092</code> 了！<br>通俗一点来讲：</p><ul><li>如果你的配置文件中是 <code>advertised.listeners=PLAINTEXT://123.xxxxxx:9092</code> ，那么你 java 配置中就需要用 <code>props.put(&quot;bootstrap.servers&quot;, &quot;123.xxxxx:9092&quot;);</code></li><li>如果你的配置文件中是 <code>advertised.listeners=PLAINTEXT://kafka1:9092</code> ，那么你 java 配置中就需要用 <code>props.put(&quot;bootstrap.servers&quot;, &quot;kafka1:9092&quot;);</code> 但是需要多一步，因为你这里写的是 kafka1，你的 java 程序并不知道要去哪里找这个 ip 来发送请求，所以你的这个 java 程序要在哪运行，就要<strong>修改那个机器的 hosts 文件</strong>，加上 ip 和主机名的映射才行！ <code>123.xxxxxx kafka1</code></li></ul><h3 id="结语"><a class="anchor" href="#结语">#</a> 结语</h3><p>其实我利用公网 ip 和利用主机名来访问的两种形式都试过了，都是可以成功的，至于上面说的利用公网 ip 会导致出现 <code>Broker may not be available</code> 的问题，我姑且把他归罪于网络动荡问题，因为我大半夜的用公网 ip 的形式有这个问题，但是白天想不明白又用公网 ip 测试了一遍又成了....<br><img data-src="https://tva3.sinaimg.cn/large/006yBBDDly8h1g1duwdojj301u021a9t.jpg" alt="" height="150px"></p><h3 id="总结"><a class="anchor" href="#总结">#</a> 总结</h3><ol><li>如果需要外网访问 kafka，或者部署在云服务器上要使用，一定要配置 <code>advertised.listeners</code> 参数，并且一定要用公网 ip！</li><li>不论是采用公网 ip 形式还是主机名形式，java 中的连接字符串一定要和 <code>advertised.listeners</code> 中 <code>PLAINTEXT://</code> 后面的内容完全相同才行！</li></ol><div class="tags"><a href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/" rel="tag"><i class="ic i-tag"></i> 中间件</a> <a href="/tags/%E6%A1%86%E6%9E%B6/" rel="tag"><i class="ic i-tag"></i> 框架</a> <a href="/tags/Kafka/" rel="tag"><i class="ic i-tag"></i> Kafka</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2022-04-20 11:44:21" itemprop="dateModified" datetime="2022-04-20T11:44:21+08:00">2022-04-20</time> </span><span id="2022/04/19/Java/Kafka的安装/" class="item leancloud_visitors" data-flag-title="Kafka的安装" title="阅读次数"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">阅读次数</span> <span class="leancloud-visitors-count"></span> <span class="text">次</span></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="蝶风 微信支付"><p>微信支付</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>蝶风 <i class="ic i-at"><em>@</em></i>永恒绿洲</li><li class="link"><strong>本文链接：</strong> <a href="https://sprenedayf.com/2022/04/19/Java/Kafka%E7%9A%84%E5%AE%89%E8%A3%85/" title="Kafka的安装">https://sprenedayf.com/2022/04/19/Java/Kafka的安装/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2022/04/18/Java/Zookeeper%E7%9A%84%E5%AD%A6%E4%B9%A0%E4%B9%8B%E6%97%852%E2%80%94%E2%80%94%E5%AE%9E%E8%B7%B5/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;tva1.sinaimg.cn&#x2F;mw690&#x2F;75c23013ly8h26ki51czfj20j60asmyp.jpg" title="Zookeeper的学习之旅2——实践"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> Zookeeper</span><h3>Zookeeper的学习之旅2——实践</h3></a></div><div class="item right"><a href="/2022/04/19/Java/Kafka%E5%AD%A6%E4%B9%A0%E4%B9%8B%E6%97%851/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;tva1.sinaimg.cn&#x2F;mw690&#x2F;75c23013ly8h26kncm4i9j20j60asabn.jpg" title="Kafka学习之旅1"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> Kafka</span><h3>Kafka学习之旅1</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%A9%E7%94%A8docker%E5%AE%89%E8%A3%85"><span class="toc-number">1.</span> <span class="toc-text">利用 Docker 安装</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AAdocker%E7%BD%91%E7%BB%9C"><span class="toc-number">1.1.</span> <span class="toc-text">创建一个 docker 网络</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%90%AD%E5%BB%BAzookeeper%E9%9B%86%E7%BE%A4"><span class="toc-number">1.2.</span> <span class="toc-text">搭建 zookeeper 集群</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%90%AD%E5%BB%BAkafka%E9%9B%86%E7%BE%A4"><span class="toc-number">1.3.</span> <span class="toc-text">搭建 kafka 集群</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E4%B8%80%E4%B8%8B"><span class="toc-number">1.4.</span> <span class="toc-text">测试一下</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#20220420%E6%9B%B4%E6%96%B0%E4%BF%AE%E6%AD%A3"><span class="toc-number">1.5.</span> <span class="toc-text">2022.04.20 更新修正</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#docker%E4%B8%8E%E7%9B%B4%E6%8E%A5%E9%83%A8%E7%BD%B2%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">1.5.1.</span> <span class="toc-text">docker 与直接部署的区别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#listeners%E4%B8%8Eadvertisedlisteners%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">1.5.2.</span> <span class="toc-text">listeners 与 advertised.listeners 的区别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#java%E7%A8%8B%E5%BA%8F%E4%B8%8Eadvertisedlisteners%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="toc-number">1.5.3.</span> <span class="toc-text">java 程序与 advertised.listeners 的关系</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%93%E8%AF%AD"><span class="toc-number">1.5.4.</span> <span class="toc-text">结语</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">1.5.5.</span> <span class="toc-text">总结</span></a></li></ol></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li class="active"><a href="/2022/04/19/Java/Kafka%E7%9A%84%E5%AE%89%E8%A3%85/" rel="bookmark" title="Kafka的安装">Kafka的安装</a></li><li><a href="/2022/04/19/Java/Kafka%E5%AD%A6%E4%B9%A0%E4%B9%8B%E6%97%851/" rel="bookmark" title="Kafka学习之旅1">Kafka学习之旅1</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="蝶风" data-src="/images/avatar.jpg"><p class="name" itemprop="name">蝶风</p><div class="description" itemprop="description">努力学习、生活</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">20</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">17</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">19</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item zhihu" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3Blb3BsZS9jaG9uZ2NvbmdjaG9uZw==" title="https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;chongcongchong"><i class="ic i-zhihu"></i></span> <span class="exturl item email" data-url="bWFpbHRvOmQxLnRiQHlhbmRleC5jb20=" title="mailto:d1.tb@yandex.com"><i class="ic i-envelope"></i></span> <span class="exturl item bilibili" data-url="aHR0cHM6Ly9zcGFjZS5iaWxpYmlsaS5jb20vMjA1Nzc1Njc/c3BtX2lkX2Zyb209MzMzLjEwMDcuMC4w" title="https:&#x2F;&#x2F;space.bilibili.com&#x2F;20577567?spm_id_from&#x3D;333.1007.0.0"><i class="ic i-bilibili"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>友链</a></li><li class="item"><a href="/talking/" rel="section"><i class="ic i-fedora"></i>说说</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2022/04/18/Java/Zookeeper%E7%9A%84%E5%AD%A6%E4%B9%A0%E4%B9%8B%E6%97%852%E2%80%94%E2%80%94%E5%AE%9E%E8%B7%B5/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2022/04/19/Java/Kafka%E5%AD%A6%E4%B9%A0%E4%B9%8B%E6%97%851/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/Java/" title="分类于 Java">Java</a> <i class="ic i-angle-right"></i> <a href="/categories/Java/%E4%B8%AD%E9%97%B4%E4%BB%B6/" title="分类于 中间件">中间件</a> <i class="ic i-angle-right"></i> <a href="/categories/Java/%E4%B8%AD%E9%97%B4%E4%BB%B6/Kafka/" title="分类于 Kafka">Kafka</a></div><span><a href="/2022/04/19/Java/Kafka%E5%AD%A6%E4%B9%A0%E4%B9%8B%E6%97%851/" title="Kafka学习之旅1">Kafka学习之旅1</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Java/" title="分类于 Java">Java</a> <i class="ic i-angle-right"></i> <a href="/categories/Java/%E4%B8%AD%E9%97%B4%E4%BB%B6/" title="分类于 中间件">中间件</a> <i class="ic i-angle-right"></i> <a href="/categories/Java/%E4%B8%AD%E9%97%B4%E4%BB%B6/Zookeeper/" title="分类于 Zookeeper">Zookeeper</a></div><span><a href="/2022/04/15/Java/Zookeeper%E7%9A%84%E5%AD%A6%E4%B9%A0%E4%B9%8B%E6%97%851/" title="Zookeeper的学习之旅1">Zookeeper的学习之旅1</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Java/" title="分类于 Java">Java</a> <i class="ic i-angle-right"></i> <a href="/categories/Java/%E7%BB%8F%E9%AA%8C%E6%80%BB%E7%BB%93/" title="分类于 经验总结">经验总结</a></div><span><a href="/2022/05/04/Java/%E8%AE%B0%E4%B8%80%E6%AC%A1MyBatis%E5%B0%81%E8%A3%85%E7%BB%93%E6%9E%9C%E9%9B%86java-lang-Integer-cannot-be-cast-to-java-lang-String%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/" title="记一次MyBatis封装结果集java.lang.Integer cannot be cast to java.lang.String异常处理">记一次MyBatis封装结果集java.lang.Integer cannot be cast to java.lang.String异常处理</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2020/08/13/theme-shoka-doc/special/" title="Step.4 主题特殊功能">Step.4 主题特殊功能</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Java/" title="分类于 Java">Java</a> <i class="ic i-angle-right"></i> <a href="/categories/Java/%E4%B8%AD%E9%97%B4%E4%BB%B6/" title="分类于 中间件">中间件</a> <i class="ic i-angle-right"></i> <a href="/categories/Java/%E4%B8%AD%E9%97%B4%E4%BB%B6/Zookeeper/" title="分类于 Zookeeper">Zookeeper</a></div><span><a href="/2022/04/15/Java/Zookeeper%E7%9A%84%E5%AE%89%E8%A3%85/" title="Zookeeper的安装">Zookeeper的安装</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/life/" title="分类于 生活杂谈">生活杂谈</a> <i class="ic i-angle-right"></i> <a href="/categories/life/%E7%B5%AE%E7%B5%AE%E5%8F%A8%E5%8F%A8/" title="分类于 絮絮叨叨">絮絮叨叨</a></div><span><a href="/2022/04/24/life/%E4%B8%80%E7%AF%87%E4%B8%8D%E7%9F%A5%E9%81%93%E8%AF%A5%E8%B5%B7%E4%BB%80%E4%B9%88%E5%90%8D%E5%AD%97%E7%9A%84%E7%A2%8E%E7%A2%8E%E5%BF%B5/" title="一篇不知道该起什么名字的碎碎念">一篇不知道该起什么名字的碎碎念</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/life/" title="分类于 生活杂谈">生活杂谈</a> <i class="ic i-angle-right"></i> <a href="/categories/life/%E5%AE%9E%E4%B9%A0%E6%84%9F%E6%82%9F/" title="分类于 实习感悟">实习感悟</a></div><span><a href="/2022/06/18/life/intern%20life/%E5%AE%9E%E4%B9%A0%E7%AC%AC%E4%B8%80%E5%91%A8%E7%9A%84%E4%BA%BF%E7%82%B9%E7%82%B9%E6%84%9F%E6%82%9F/" title="实习第一周的亿点点感悟">实习第一周的亿点点感悟</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Java/" title="分类于 Java">Java</a> <i class="ic i-angle-right"></i> <a href="/categories/Java/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" title="分类于 基础知识">基础知识</a></div><span><a href="/2022/05/07/Java/%E6%93%8D%E4%BD%9C%E6%95%B0%E6%8D%AE%E5%BA%93%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%931/" title="操作数据库方法总结1">操作数据库方法总结1</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2020/08/13/theme-shoka-doc/config/" title="Step.2 基本配置">Step.2 基本配置</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Java/" title="分类于 Java">Java</a> <i class="ic i-angle-right"></i> <a href="/categories/Java/%E4%B8%AD%E9%97%B4%E4%BB%B6/" title="分类于 中间件">中间件</a> <i class="ic i-angle-right"></i> <a href="/categories/Java/%E4%B8%AD%E9%97%B4%E4%BB%B6/Kafka/" title="分类于 Kafka">Kafka</a></div><span><a href="/2022/04/19/Java/Kafka%E7%9A%84%E5%AE%89%E8%A3%85/" title="Kafka的安装">Kafka的安装</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; <span itemprop="copyrightYear">2022</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">蝶风 @ TheOnly-DF</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">131k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">2:58</span></div><span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span><script>function createtime(){var n=new Date("04/09/2022 17:38:00");now.setTime(now.getTime()+250),days=(now-n)/1e3/60/60/24,dnum=Math.floor(days),hours=(now-n)/1e3/60/60-24*dnum,hnum=Math.floor(hours),1==String(hnum).length&&(hnum="0"+hnum),minutes=(now-n)/1e3/60-1440*dnum-60*hnum,mnum=Math.floor(minutes),1==String(mnum).length&&(mnum="0"+mnum),seconds=(now-n)/1e3-86400*dnum-3600*hnum-60*mnum,snum=Math.round(seconds),1==String(snum).length&&(snum="0"+snum),document.getElementById("timeDate").innerHTML="本站已安全运行 "+dnum+" 天 ",document.getElementById("times").innerHTML=hnum+" 小时 "+mnum+" 分 "+snum+" 秒  "}var now=new Date;setInterval("createtime()",250)</script><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2022/04/19/Java/Kafka的安装/",favicon:{show:"ヽ( o･ｪ･)ﾉ欢迎回来~",hide:"•﹏•再见~"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//fastly.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html><!-- rebuild by hrmmi -->